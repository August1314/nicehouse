## 交互与代码模块梳理

> 本文档用于明确：哪些地方需要 **写 C# 脚本/交互逻辑**，方便按模块分工开发。

### 总览：主要交互模块

- 环境智控（舒适 + 智慧）
- 能耗智控（舒适 + 绿色 + 智慧）
- 智能监护（安全 + 智慧）
- 健康监测（安全 + 智慧）
- 一键呼叫（安全）
- 安全防护（安全 + 智慧）
- 系统分层查看（剖面图 / 温度 / 湿度 / PM2.5 / 活动热力图）

---

### 1. 环境智控模块

**需要代码的交互点：**

- **环境数据模拟与更新**
  - 定时或按按钮模拟 PM2.5、PM10、温度、湿度 等数据（例如随机波动或按预设曲线）
  - 使用脚本实时更新 UI（数值文本、进度条、仪表盘等）
- **自动联动逻辑**
  - 当监测值超过阈值（如 PM2.5 > 某值）时，自动触发：
    - 开启“新风系统”设备（播放动画/改变材质/显示设备运转状态）
    - 调整空调状态（温度设定改变、显示“制冷/制热中”等）
- **用户交互控制**
  - 面板或按钮：手动开启/关闭空调、新风
  - 切换模式：自动模式 / 手动模式（脚本中控制不同逻辑分支）

**对应代码建议：**

- `EnvironmentController.cs`：管理环境数据、阈值判断、自动联动
- `EnvironmentPanelUI.cs`：负责 UI 显示与按钮事件绑定

**与模型相关的分割与交互建议：**

- **空调 / 新风系统（Air Conditioner / Fresh Air System）**
  - 分割要求：
    - 必须与墙面分离，作为独立的 GameObject。
    - 进阶：出风口导风板（Vents）单独拆成子物体，便于做扫风动画。
  - 交互目的：
    - 开启时播放导风板扫风动画，或在出风口位置播放冷气粒子特效。
    - 与 `EnvironmentController` 和能耗模块联动，体现“开启制冷/新风”的状态。

- **空气净化器（Air Purifier）**
  - 分割要求：
    - 机身独立；
    - 若有风扇，扇叶（Fan Blades）最好与机身分离，作为子物体。
  - 交互目的：
    - 当 PM2.5 超标时，自动开启净化器，扇叶旋转（可用 `transform.Rotate` 或动画）。

- **风扇（Fan）**
  - 分割要求：
    - 扇叶（Blades）必须与底座（Base）分离，扇叶作为可旋转子物体。
  - 交互目的：
    - 代码控制扇叶绕 Z 轴旋转，实现风扇转动效果。

- **温控面板（Thermostat Panel）**
  - 分割要求：
    - 作为一个单独的挂墙物体，便于挂交互脚本与 Collider。
  - 交互目的：
    - 鼠标点击面板，通过 Raycast 或 UI 事件弹出详细温湿度数据的 UI 面板。

- **PM2.5 传感器（PM2.5 Sensor）**
  - 分割要求：
    - 作为独立挂墙或吸顶物体，单独的 GameObject。
  - 交互目的：
    - 当环境污染严重时，传感器模型变红或材质 Emission 闪烁示警。

---

### 2. 能耗智控模块

**需要代码的交互点：**

- **用电/能耗数据模拟**
  - 按时间轴模拟家庭能耗（空调、照明、家电等）
  - 不同模式下（节能 / 舒适 / 自定义）能耗曲线不同
- **智能调控逻辑**
  - 根据“用户作息时间段”自动开关设备或调节功率
  - 可视化能耗对比（例如：当前模式 vs 传统模式）
- **UI 交互**
  - 模式选择按钮：节能 / 舒适 / 平衡
  - 显示能耗统计：日/周/月用电量、估算电费等（可简化）

**对应代码建议：**

- `EnergyManager.cs`：能耗数据模型、模拟与计算
- `EnergyPanelUI.cs`：模式切换、图表刷新、数值显示

---

### 3. 智能监护模块

**需要代码的交互点：**

- **数字人行为监测**
  - 数字人有“站立、行走、久坐、久浴、躺下”等状态
  - 通过脚本控制状态切换（可用按钮或自动时间线）
- **异常检测逻辑**
  - 当处于“久坐”“久浴”等状态超过一定时间，触发预警
  - 模拟“跌倒/坠床”事件：脚本触发动画 + 报警逻辑
- **报警与反馈**
  - 弹出 UI 提示、播放报警音效、闪烁灯光/红色标记区域

**对应代码建议：**

- `PersonStateController.cs`：管理数字人状态机
- `MonitoringSystem.cs`：基于状态与时间的异常检测逻辑
- `AlarmUIController.cs`：统一控制报警弹窗、声音、灯光效果

---

### 4. 健康监测模块

**需要代码的交互点：**

- **生命体征数据模拟**
  - 心率、呼吸、体动、睡眠阶段（清醒/浅睡/深睡）
  - 通过脚本定时更新这些数据
- **异常预警逻辑**
  - 数据超出正常范围（如心率过高/过低）时触发预警
  - 生成简化的“异常报告”展示在 UI 上
- **可视化**
  - 折线图/柱状图/仪表盘：展示心率随时间变化等

**对应代码建议：**

- `HealthDataSimulator.cs`：模拟与更新健康数据
- `HealthWarningSystem.cs`：阈值判断与告警
- `HealthChartUI.cs`：负责将数据渲染为图表或仪表盘

---

### 5. 一键呼叫模块

**需要代码的交互点：**

- **紧急按钮交互**
  - UI 上的“一键呼叫”按钮点击事件
  - 或房间内 3D 设备模型的点击/碰撞触发
- **求助信息发送（模拟）**
  - 在 UI 面板显示“已向平台发送求助信息”
  - 在日志面板/提示框中记录触发时间、房间位置等
- **现场警示效果**
  - 声音：播放警报音
  - 灯光：房间灯光闪烁

**对应代码建议：**

- `EmergencyCallController.cs`：处理按钮事件、状态切换、冷却时间等
- `SceneAlertEffect.cs`：统一控制灯光闪烁、声音播放

**与模型相关的分割与交互建议：**

- **互助按钮（Help Button）**
  - 分割要求：
    - 按钮面板独立，便于添加 Collider 与高亮效果。
  - 交互目的：
    - 鼠标点击时通过 Raycast 检测，触发“一键呼叫”事件，联动报警 UI、声音和灯光。

- **室内灯带 / 照明灯（Light Strips / Lamps）**
  - 分割要求：
    - 灯具模型独立，且材质球独立，避免与墙体共用材质。
  - 交互目的：
    - 紧急情况或告警时，通过脚本改变灯光或材质 Emission，实现灯光闪烁提示异常。

---

### 6. 安全防护模块

**需要代码的交互点：**

- **烟雾/火灾模拟**
  - 通过脚本控制烟雾粒子效果开启/关闭
  - 当“烟雾浓度”模拟值超过阈值时触发
- **报警与联动**
  - 触发烟感传感器 → 声光报警器 → 自动打开窗户/门等
  - UI 中显示“当前告警级别”“告警来源房间”
- **远程监控/人物跟踪（可简化）**
  - 摄像机自动跟随数字人，或开启/关闭“全屋监视视角”

**对应代码建议：**

- `FireSafetyController.cs`：烟雾浓度模拟与阈值检测
- `WindowController.cs`：控制窗户/门的开合动画
- 可复用前面的 `AlarmUIController.cs` 来显示报警信息

**与模型相关的分割与交互建议：**

- **窗户（Windows）**
  - 分割要求：
    - 窗扇（Window Sash / Glass）必须与窗框（Frame）及墙体分离。
    - Pivot（轴心点）需设置在合页处，便于做旋转开合动画。
  - 交互目的：
    - 烟雾报警时，`WindowController` 控制窗扇旋转打开，模拟自动通风。

- **烟雾 / 燃气传感器（Smoke / Gas Sensor）**
  - 分割要求：
    - 吸顶独立物体，拥有自己的 Mesh 与材质。
  - 交互目的：
    - 烟雾浓度高时，传感器指示灯闪烁或变色，与 `FireSafetyController` 联动。

- **声光报警器（Alarm）**
  - 分割要求：
    - 独立挂墙物体，单独材质球。
  - 交互目的：
    - 触发报警时，通过脚本改变材质 Emission 属性，实现红光爆闪效果。

---

### 7. 系统分层查看与数据可视化模块

#### 7.1 剖面图

**需要代码的交互点：**

- 通过按钮/滑条控制“剖切平面”的高度或方向
- 动态隐藏/显示部分楼层或墙体（切换不同剖面模式）

**对应代码建议：**

- `SectionViewController.cs`：控制剖面模式与模型显隐

#### 7.2 温度 / 湿度 / PM2.5 分布

**需要代码的交互点：**

- 按房间或空间网格生成数据（简化为每个房间一个数值）
- 通过颜色渐变（红→黄→蓝）或 UI 图标显示房间状态
- 在 UI 上切换显示模式：温度 / 湿度 / PM2.5

**对应代码建议：**

- `EnvironmentFieldData.cs`：管理各房间的环境数据
- `RoomHeatmapRenderer.cs`：根据数据刷新颜色/贴图

**与模型相关的分割与交互建议：**

- **地板（Floor）**
  - 分割要求：
    - 绝对核心：地板必须是独立的一块或多块 Mesh，严禁与墙壁合并。
  - 交互目的：
    - 赋予自定义的“热力图 Shader”或脚本，根据温度或活动数据改变地板颜色（红-黄-蓝渐变）。  
    - 若与墙壁连在一起，墙壁也会跟着变色，会严重影响观感和评分。

- **天花板 / 屋顶（Ceiling / Roof）**
  - 分割要求：
    - 必须独立 Mesh，与墙体和其他结构分离。
  - 交互目的：
    - 在“上帝视角”或“剖面查看”模式下，通过脚本隐藏（`SetActive(false)`）天花板，让用户能清楚看到室内结构与热力图分布。

#### 7.3 活动热力图

**需要代码的交互点：**

- 模拟家庭成员在各房间的停留时间/访问频率
- 将频次映射成颜色（客厅/厨房红色，高频；次卧蓝色，低频）
- 提供时间段筛选（全天 / 上午 / 晚上等，可简化）

**对应代码建议：**

- `ActivitySimulator.cs`：模拟活动轨迹与频率统计
- `ActivityHeatmapRenderer.cs`：根据统计结果渲染热力图

---

### 8. 总结：必须写代码的关键点清单

- **数据模拟与更新**：环境数据、能耗数据、健康数据、活动数据等（避免一切都是“静态贴图”）
- **阈值判断与自动联动**：超标→自动开设备、异常→自动报警/提示
- **UI 交互**：按钮、滑条、模式切换、弹窗提示
- **场景/对象控制**：摄像机视角、数字人状态、设备开关、灯光/窗户动画
- **可视化渲染**：温度分布、热力图、折线图/仪表盘等

> 建议：每一个模块（环境、能耗、监护、健康、一键呼叫、安全、防护、分层查看）至少有 **1–2 个脚本组件**，并在 `docs/tasks.md` 中标明负责人和预计完成时间。


